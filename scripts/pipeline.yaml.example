# DeepRank-Ab Pipeline Configuration
# Copy this file to pipeline.yaml and edit for your run

# Required paths
run_root: /path/to/run_001           # Output directory (will be created)
pdb_root: /path/to/input_pdbs        # Input PDB directory
deeprank_root: /path/to/DeepRank-Ab  # DeepRank-Ab repository root
model_path: /path/to/model.pth       # Trained model weights

# Chain identifiers in input PDBs
chains:
  heavy: H
  light: "-"      # Use "-" for VHH (no light chain)
  antigen: T

# Stage A (CPU): Graph generation
stage_a:
  partition: norm
  cores: 32
  mem_gb: 64
  time: "01:00:00"
  array: "0-9%10"           # SLURM array spec (adjust based on shard count)
  # Sharding parameters
  target_shard_gb: 0.1
  min_per_shard: 10
  max_per_shard: 100
  glob: "**/*.pdb"
  # Voronota settings
  voronota_binary: voronota_129   # voronota | voronota_129 | voronota-lt
  use_freesasa: 1                  # 1 = freesasa, 0 = voronota-lt for BSA
  voro_omp_threads: 1              # OpenMP threads per voronota call

# Stage B (GPU): ESM embeddings + inference
stage_b:
  partition: gpu
  gpus: 4
  cores: 32
  mem_gb: 128
  time: "04:00:00"
  array: "0-9%5"            # SLURM array spec
  # ESM settings
  esm_model: esm2_t33_650M_UR50D
  esm_toks_per_batch: 12288
  esm_scalar_dtype: float16
  # Inference settings
  batch_size: 64
  dl_workers: 8
  prefetch_factor: 4

# Stage C (CPU): Merge predictions
stage_c:
  partition: norm
  cores: 4
  mem_gb: 16
  time: "02:00:00"

# Optional settings
collect_metrics: true       # Enable compute metrics sampling
metrics_interval: 2         # Sampling interval in seconds
